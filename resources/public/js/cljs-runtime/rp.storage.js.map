{"version":3,"sources":["rp/storage.cljs"],"mappings":";AAGA,oBAAA,pBAAKA;AAEL;;;2BAAA,3BAAMC;AAAN,AAGE,IAAA,AACE,OAAUE,qBAAgBH,kBAAO,AAACI;gBADpC,QAAAF,JAEkBG;AAFlB,AAGI,qBAAA,dAACC,mCAAsCD;;AAE7C;;;2BAAA,3BAAME,8DAEHC;AAFH,AAGE,IAAA,AACE,IAAAE,2BAAgB,AAAUP,qBAAgBH;AAA1C,AAAA,oBAAAU;AAAA,AAAA,iBAAAA,bAAWC;AAAX,AACE,AAACC,0BAAkBD;;AADrB;gBADF,cAAAF,VAGkBJ;AAHlB,AAII,cAAA,dAACC,mCAAsCD;;AAG3C,sCAAA,tCAACQ,oBAAUC,iFACA,WAAKC,EAAEA,MAAEA,MAAEA;AAAX,AACE,OAACd;;;AAEd,QAACO,4CAAAA,8CAAAA","names":["rp.storage/DB-KEY","rp.storage/save-db!","e49654","js/localStorage","rp.db/db->edn","e","js/console.error","rp.storage/load-db!","on-complete","e49655","temp__5823__auto__","data","rp.db/load-from-edn!","cljs.core/add-watch","rp.db/db-listener","_"],"sourcesContent":["(ns rp.storage\n  (:require [rp.db :as db]))\n\n(def DB-KEY \"rp-workout-db\")\n\n(defn save-db!\n  \"Persist the database to localStorage.\"\n  []\n  (try\n    (.setItem js/localStorage DB-KEY (db/db->edn))\n    (catch :default e\n      (js/console.error \"Failed to save DB:\" e))))\n\n(defn load-db!\n  \"Load the database from localStorage and call callback when done.\"\n  [on-complete]\n  (try\n    (when-let [data (.getItem js/localStorage DB-KEY)]\n      (db/load-from-edn! data))\n    (catch :default e\n      (js/console.error \"Failed to load DB:\" e)))\n  \n  ;; Auto-save on every transaction\n  (add-watch db/db-listener :auto-save\n             (fn [_ _ _ _]\n               (save-db!)))\n  \n  (on-complete))\n\n;; Future: IndexedDB for larger datasets\n;; localStorage has ~5MB limit, fine for workout logs\n"]}